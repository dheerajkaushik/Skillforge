services:
  # 1. Backend Service
  - type: web
    name: skillforge-backend
    runtime: docker
    rootDir: backend
    plan: free
    envVars:
      - key: SPRING_DATASOURCE_URL
        sync: false
      - key: SPRING_DATASOURCE_USERNAME
        sync: false
      - key: SPRING_DATASOURCE_PASSWORD
        sync: false
      - key: SPRING_DATASOURCE_DRIVER_CLASS_NAME
        value: org.postgresql.Driver
      # ✅ FIX 1: Use interpolation to add https://
      - key: RUNNER_URL
        value: https://${skillforge-runner.host}
      - key: AWS_ACCESS_KEY_ID
        sync: false
      - key: AWS_SECRET_ACCESS_KEY
        sync: false
      - key: AWS_REGION
        value: eu-north-1      # Safe to hardcode (not a secret)
      - key: S3_BUCKET_NAME
        value: killforgepro

  # 2. Frontend Service
  - type: web
    name: skillforge-frontend
    runtime: docker
    rootDir: frontend
    plan: free
    envVars:
      # ✅ FIX 2: Use interpolation to add https://
      - key: REACT_APP_API_BASE_URL
        value: https://${skillforge-backend.host}

  # 3. Runner Service
  - type: web
    name: skillforge-runner
    runtime: docker
    rootDir: skillforge-runner
    plan: free
    envVars:
      - key: DUMMY_VAR
        value: active